@using FhirBlaze.SharedComponents.Components

@namespace FhirBlaze.AllergyIntoleranceModule.Components

<EditForm Model="@AllergyIntolerance" OnValidSubmit="@SaveAllergyIntolerance">
  <DataAnnotationsValidator />
  <ValidationSummary />

  <div class="container">
    <div class="row">
      <div class="form-group col-sm">
        <label class="control-label" for="Id">Id</label>
        <InputText id="Id" disabled @bind-Value="AllergyIntolerance.Id" class="form-control" style="" />
      </div>
      <div class="form-group col-sm">
        <label class="control-label">Business Identifier(s)</label>
        @foreach (var item in this.AllergyIntolerance.Identifier)
        {
          <div>
            <input type="text" @bind="item.Value" class="form-control" />
          </div>
        }
      </div>
    </div>

    <div class="row">
      <div class="form-group col-md">
        <label class="control-label">Clinical Status</label>
        <div>
          <select type="text" @bind="this.ClinicalStatus" class="form-control">
            @for (int i = 0; i < this.ClinicalStatuses.Length; i++)
            {
              <option value="@this.ClinicalStatuses[i]">@this.ClinicalStatuses[i]</option>
            }
          </select>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="form-group col-md">
        <label class="control-label">Verification Status</label>
        <div>
          <select type="text" @bind="this.VerificationStatus" class="form-control">
            @for (int i = 0; i < this.VerificationStatuses.Length; i++)
            {
              <option value="@this.VerificationStatuses[i]">@this.VerificationStatuses[i]</option>
            }
          </select>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="form-group col-md">
        <label class="control-label">Type of Underlying Mechanism (if known)</label>
        <div>
          <select type="text" @bind="this.SelectedType" class="form-control">
            <option>Allergy</option>
            <option>Intolerance</option>
          </select>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="form-group col-md">
        <label class="control-label">Patient (Who the sensitivity is for)</label>
        <div>
          <select type="text" @bind="this.SelectedPatientId" class="form-control">
            @if (this.Patients != null)
            {
              @foreach (var patient in this.Patients)
              {
                <option value="@patient.Id">@patient.Name.FirstOrDefault()</option>
              }
            }
            else
            {
              <option>No Patient to select</option>
            }
          </select>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="form-group col-md">
        <label class="control-label">Who recorded the sensitivity?</label>
        <div>
          <select type="text" @bind="this.RecorderType" class="form-control">
            <option selected>Patient</option>
            <option>Practitioner</option>
          </select>
        </div>
        <div>
          @switch (this.RecorderType)
          {
            case "Patient":
              <select type="text" @bind="this.SelectedRecorder" class="form-control">
                @if (this.Patients != null)
                {
                  @foreach (var patient in this.Patients)
                  {
                    <option value="@this.RecorderType/@patient.Id">@patient.Name.FirstOrDefault()</option>
                  }
                }
                else
                {
                  <option>No Practitioner to select</option>
                }
              </select>
              break;
            case "Practitioner":
              <select type="text" @bind="this.SelectedRecorder" class="form-control">
                @if (this.Practitioners != null)
                {
                  @foreach (var practitioner in this.Practitioners)
                  {
                    <option value="@this.RecorderType/@practitioner.Id">@practitioner.Name.FirstOrDefault()</option>
                  }
                }
                else
                {
                  <option>No Practitioner to select</option>
                }
              </select>
              break;
          }
        </div>
      </div>
    </div>

    <div class="row">
      <div class="form-group col-md">
        <label class="control-label">Recorded Date</label>
        <div>
          <InputDate @bind-Value="this.SelectedRecordedDate" class="form-control" />
        </div>
      </div>
    </div>

    <hr />

    <div class="row">
      <div class="col-sm-11">Note(s)</div>
      <div class="col-sm-1">
        <button type="button" class="btn btn-primary" @onclick="AddNoteAnnotation"><span class="oi oi-plus" /></button>
      </div>
    </div>
    <div class="row form-group">
      @foreach (var note in this.AllergyIntolerance.Note)
      {
        <div class="col-sm-11">
          <AnnotationComponent Note="note" />
        </div>
        <div class="col-sm-1">
          <button type="button" class="btn btn-primary" @onclick="(() => RemoveNoteAnnotation(note))">
            <span class="oi oi-trash" />
          </button>
        </div>
      }
    </div>
  </div>

  @if (Processing)
  {
    <div class="row">
      <div class="col-sm-11"><button type="button" class="btn btn-primary-outline" disabled>Processing</button></div>
    </div>
  }
  else
  {
    <div class="row">
      <div class="col-sm-11"><button type="submit" class="btn btn-primary">Save</button></div>
    </div>
  }
  </EditForm>
